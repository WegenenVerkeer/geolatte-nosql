${{header}}
${{loader-functions}}
${{control-functions}}

addGroup ${{daemon_group}} "${{daemon_group_gid}}"
addUser ${{daemon_user}} "${{daemon_user_uid}}" ${{daemon_group}} "${{app_name}} user-daemon" "${{daemon_shell}}"

${{chown-paths}}

if [ `which ufw` ] ; then
  sudo ufw allow 8080/tcp
fi

echo "Generating config file"
# Use penfold to generate config file based on template
if [ `which penfold` ] ; then
  penfold -r -m /usr/share/geolatte-nosqlfs/conf
else
  mv /usr/share/geolatte-nosqlfs/conf/nosql.conf.docker /usr/share/geolatte-nosqlfs/conf/nosql.conf
fi

chown ${{daemon_user}}:${{daemon_group}} /usr/share/geolatte-nosqlfs

sudo -u ${{daemon_user}} touch /var/log/geolatte-nosqlfs/logstash_application.log

startService ${{app_name}} || echo "${{app_name}} could not be registered or started"

service beaver restart | true
